<!--#include("header.html")-->
	
	<!--@if($oDocument && $oDocument->isExists())-->
	
		<div id="wikiAboveTitleArea">
			<div id="wikiLanguages">
				<!--@foreach($langs as $key => $val)-->
					<!--@if (in_array($key, $translatedlangs))-->
						<a href="#" onclick="doChangeLangType('{$key}');return false;" title="{$val}" style="border:1px solid #AA0000;">{strtoupper($key)}</a>
					<!--@else-->
						<!--@if($is_logged)-->
							<a href="#" onclick="doChangeLangType('{$key}');return false;" title="{$val}">{strtoupper($key)}</a>
						<!--@end-->
					<!--@end-->
				<!--@endforeach-->
			</div>		

			<div id="wikiBreadcrumbs">{$breadcrumbs}</div>
			
			<div class="cleared"></div>
		</div>
	
		<div id="wikiTitleArea">
			<div id="wikiEditorActions">
		    <!--@if(!$history && ($oDocument->isExists()||$use_history != 'N'))-->
				<!--@if($grant->write_document)-->
					<a href="{getUrl('act','dispWikiEditPage', 'entry', '')}"><img src="img/icon_add_page.png" alt="Add new page" title="Add new page"/></a>
				<!--@end-->
				<!--@if($oDocument->isExists()&&$act!='dispWikiEditPage'&&$grant->write_document)-->
					<a class="buttonOfficial" href="{getUrl('act','dispWikiEditPage','entry',$entry)}">
						<img src="img/icon_edit_page.png" alt="{$lang->cmd_edit}" title="{$lang->cmd_edit}"/>
					</a>
				<!--@end-->
				<!--@if($oDocument->isExists() && $grant->delete_document && $oDocument->document_srl != (int)$root->document_srl)-->
					<a class="buttonOfficial" href="#" onclick="if(confirm('{$lang->confirm_delete}')) { doDeleteWiki('{$oDocument->document_srl}'); }; return false;">
						<img src="img/icon_delete_page.png" alt="{$lang->cmd_delete}" title="{$lang->cmd_delete}"/>
					</a>
				<!--@end-->
				<!--@if($use_history != 'N')-->
					<a class="buttonOfficial" href="{getUrl('act','dispWikiHistory','document_srl',$oDocument->document_srl,'history_srl','')}">
						<img src="img/icon_history.png" alt="{$lang->histories}" title="{$lang->histories}"/>
					</a>
				<!--@end-->
		    <!--@else-->		    
				<!--@if($history)-->
					{$lang->notice_old_revision}
				<!--@end-->
				<a href="{getUrl('act','dispWikiEditPage', 'entry', '')}"><img src="img/icon_add_page.png" alt="Add new page" title="Add new page"/></a>
				<a class="buttonOfficial" href="{getUrl('act','','history_srl','')}">{$lang->cmd_back}</a>
		    <!--@end-->
			</div>						
			
		    <h2 id="wikiTitle"><a href="{getUrl('document_srl',$document_srl)}">{$oDocument->getTitle()}</a></h2>			
		</div>

		<div id="wikiBelowTitleArea">
			<div id="wikiSum">
				<span class="read">{$lang->readed_count} <span class="num">{$oDocument->get('readed_count')}</span></span>
				<span class="vote">{$lang->voted_count} <span class="num">{$oDocument->get('voted_count')}</span></span>

				<span class="date">
					<!--@if($history)-->
					<strong>{zdate($history->regdate, 'Y.m.d')}</strong> {zdate($history->regdate, 'H:i:s')}
					<!--@else-->
					<strong>{$oDocument->getUpdate('Y.m.d')}</strong> {$oDocument->getUpdate('H:i:s')} 
					<!--@end-->
				</span>					
			</div>				

			<div id="wikiAuthorArea">
				<!--@if($history)-->
				<a href="#" class="author member_{$history->member_srl}" onclick="return false;">{$history->nick_name}</a>
				<!--@else-->
				<!--@if(!$oDocument->getMemberSrl())-->
					<!--@if($oDocument->isExistsHomepage())-->
					<a href="{$oDocument->getHomepageUrl()}" onclick="window.open(this.href);return false;" class="author">{$oDocument->getNickName()}</a>
					<!--@else-->
					{$oDocument->getNickName()}
					<!--@end-->
				<!--@else-->
					<a href="#popup_menu_area" class="member_{$oDocument->get('member_srl')} author" onclick="return false">{$oDocument->getNickName()}</a>
				<!--@end-->
				<!--@end-->

				<span class="ipAddress"><!--@if($grant->manager || $module_info->display_ip_address!='N')-->{$oDocument->getIpaddress()}<!--@end--></span>
			</div>
			
			<div class="cleared"></div>
		</div>
	
	<!--@elseif($oDocument)-->
		<div id="wikiTitleArea">
			<!-- Needs to acces title with get('title') instead of getTitle() because oDocument is seen as invalid when doc_srl is 0 -->
		    <h2 class="title">{$oDocument->get('title')}</h2>
		</div>
	<!--@end-->

	<div id="wikiContentContainer">
		<!--@if($oDocument->isSecret() && !$oDocument->isGranted())-->
			<form action="./" method="get" ruleset="input_password" class="secretMessage">
				<input type="hidden" name="act" value="procWikiVerificationPassword" />
				<input type="hidden" name="success_return_url" value="{getUrl('act','dispWikiContent','mid',$mid,'entry',$entry)}" />
				<input type="hidden" name="mid" value="{$mid}" />
				<input type="hidden" name="page" value="{$page}" />
				<input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />

				<p>&quot;{$lang->msg_is_secret}&quot;</p>
				<dl>
					<dt><label for="cpw">{$lang->password}</label> :</dt>
					<dd><input type="password" name="password" id="cpw" class="inputText" /><span class="buttonOfficial"><input type="submit" value="{$lang->cmd_input}" /></span></dd>
				</dl>

			</form>
		<!--@else-->
            <!--@if($history)-->
                {@ $document_content = $history->content}
            <!--@else-->
                {@ $document_content = $oDocument->getContent()}
            <!--@end-->
			<!--@if ($markup_type != 'xe_wiki_markup')-->
				{$document_content}
			<!--@else-->
				{nl2br($document_content)}
			<!--@end-->
		<!--@end-->
	</div>

	<div id="wikiNavigation">
	<!--@if($oDocumentPrev)-->
		<a href="{getUrl('document_srl',$oDocumentPrev->document_srl)}" class="wikiPrev">&laquo; {$oDocumentPrev->getTitle()}</a>
	<!--@end-->
	<!--@if($oDocumentNext)-->
		<a href="{getUrl('document_srl',$oDocumentNext->document_srl)}" class="wikiNext">{$oDocumentNext->getTitle()} &raquo;</a>
	<!--@end-->
	</div>

	{@ $tag_list = $oDocument->get('tag_list') }
	<!--@if(count($tag_list))-->
	<dl id="wikiTags">
		<dt>{$lang->tag}</dt>
		<!--@for($i=0;$i<count($tag_list);$i++)-->
			{@ $tag = $tag_list[$i]; }
			<dd><a href="{getUrl('search_target','tag','search_keyword',$tag,'document_srl','')}" rel="tag">{htmlspecialchars($tag)}</a></dd>
		<!--@end-->
	</dl>
	<!--@end-->

	<!--@if($oDocument->hasUploadedFiles())-->
	<dl id="wikiAttachedFiles">
		<dt>{$lang->uploaded_file}<input type="button" class="fileToggle" onclick="jQuery(this).parents('dl#wikiAttachedFiles').toggleClass('open');return false;" value="{$lang->uploaded_file} ({$oDocument->get('uploaded_count')})" /></dt>
		<dd>
			<ul class="files">
				{@ $uploaded_list = $oDocument->getUploadedFiles() }
				<!--@foreach($uploaded_list as $key => $file)-->
				<li><a href="{getUrl('')}{$file->download_url}">{$file->source_filename} <span class="bubble">[File Size:{FileHandler::filesize($file->file_size)}/Download:{number_format($file->download_count)}]</span></a></li>
				<!--@end-->
			</ul>
		</dd>
	</dl>
	<!--@end-->

	<!--@if(!$oDocument->getTrackbackCount())-->
	<dl id="wikiTrackback">
		<dt>{$lang->trackback} : </dt>
		<dd><a href="{$oDocument->getTrackbackUrl()}" onclick="return false;">{$oDocument->getTrackbackUrl()}</a></dd>
	</dl>
	<!--@end-->

	<!--@if($contributors)-->
	<dl id="wikiContributors">
		<dt>{$lang->contributors} : </dt>
		<dd><!--@foreach($contributors as $key => $val)--><a href="#" class="member_{$val->member_srl}" onclick="return false;">{$val->nick_name}</a><!--@if($key<count($contributors)-1)-->, <!--@end--><!--@end--></dd>
	</dl>
	<!--@end-->


	<!--@if($oDocument->allowTrackback())-->
		<!--#include("./trackback.html")-->
	<!--@end-->
	
	<div id="wikiComments">
	<!--@if($oDocument->allowComment())-->
		<a name="comment"></a>
		<!--#include("./comment.html")-->

		<!--@if($grant->write_comment && $oDocument->isEnableComment() )-->
			<!--@if(!$is_logged)-->
				{@ $ruleset = "insert_comment_not_logged"}
				{@ $act_insert = "procWikiInsertCommentNotLogged"}
			<!--@else-->
				{@ $ruleset = "insert_comment"}
				{@ $act_insert = "procWikiInsertComment"}
			<!--@end-->
			<form action="./" method="post" ruleset="{$ruleset}" class="wikiEditor" >
				<input type="hidden" name="act" value="{$act_insert}" />
				<input type="hidden" name="success_return_url" value="{getUrl('act','dispWikiContent','mid',$mid,'entry',$entry)}" />
				<input type="hidden" name="mid" value="{$mid}" />
				<input type="hidden" name="document_srl" value="{$oDocument->document_srl}" />
				<input type="hidden" name="comment_srl" value="" />
				<input type="hidden" name="content" value="" />
				<div class="wikiWrite commentEditor">
					<div class="editor"></div>
					<div id="editor-box">
						<span class="button" id="loadEditorButton" ><a onclick="loadCommentForm({$oDocument->document_srl})">{$lang->leave_comment}</a></span>
					</div>
					<div class="editorOption">
					<!--@if(!$is_logged)-->
						<input type="text" name="nick_name" class="inputText userName" value="{$lang->writer}" onfocus="this.value=''" />
						<input type="password" name="password" class="inputText userPw" value="{$lang->password}" onfocus="this.value=''" />
						<input type="text" name="email_address" class="inputText emailAddress" value="{$lang->email_address}" onfocus="this.value=''" />
						<input type="text" name="homepage" class="inputText homePage" value="{$lang->homepage}" onfocus="this.value=''" />
					<!--@end-->

					<!--@if($is_logged)-->
						<input type="checkbox" name="notify_message" value="Y" id="notify_message" class="inputCheck" />
						<label for="notify_message">{$lang->notify}</label>
					<!--@end-->
						<input type="checkbox" name="is_secret" value="Y" id="is_secret" class="inputCheck" />
						<label for="is_secret">{$lang->secret}</label>
					</div>

					<div class="wikiNavigation hide">
						<span class="buttonOfficial"><input type="submit" value="{$lang->cmd_comment_registration}" accesskey="s" /></span>
						<span class="buttonOfficial"><input type="button" value="{$lang->cancel}" onclick="hideEditor()" /></span>
					</div>

				</div>

			</form>
		<!--@end-->
	<!--@end-->
	</div>
	
<!--#include("footer.html")-->
